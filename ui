-- DEMONHUB UI for Roblox Farming Game
-- Version: 1.0.3
local function createUI(tables, functions, services, settings, coroutines, petData, petModelCache)
    local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
    local mutationNames = {}
    for mutation, _ in pairs(tables.Mutations) do table.insert(mutationNames, mutation) end
    table.sort(mutationNames)

    local Window = WindUI:CreateWindow({
        Title = "DEMONHUB",
        Icon = "rbxassetid://7733964712",
        Author = "DEMONHUB Team",
        Folder = "DEMONHUB",
        Size = UDim2.fromOffset(500, 400),
        Theme = "Dark",
        HasOutline = true,
        KeySystem = {
            Key = {"DEMON123", "HUB456"},
            Note = "Enter key: DEMON123 or HUB456",
            SaveKey = true
        }
    })

    local Tabs = {}
    Tabs.PetsSection = Window:Section({Title = "Pets", Opened = true})
    Tabs.PetsTab = Tabs.PetsSection:Tab({Title = "Pets", Icon = "paw-print", Desc = "Manage your pets"})
    Tabs.EggsTab = Tabs.PetsSection:Tab({Title = "Eggs", Icon = "egg", Desc = "Manage egg hatching and planting"})
    Tabs.PurchasesSection = Window:Section({Title = "Purchases", Opened = false})
    Tabs.PurchasesTab = Tabs.PurchasesSection:Tab({Title = "Buy Items", Icon = "shopping-cart", Desc = "Purchase eggs, seeds, and gear"})
    Tabs.FarmingSection = Window:Section({Title = "Farming", Opened = false})
    Tabs.FarmingTab = Tabs.FarmingSection:Tab({Title = "Plants", Icon = "sprout", Desc = "Auto planting"})
    Tabs.HarvestingSection = Window:Section({Title = "Harvesting", Opened = false})
    Tabs.HarvestingTab = Tabs.HarvestingSection:Tab({Title = "Auto Harvesting", Icon = "apple", Desc = "Auto harvest"})
    Tabs.SellingSection = Window:Section({Title = "Selling", Opened = false})
    Tabs.SellingTab = Tabs.SellingSection:Tab({Title = "Auto Selling", Icon = "dollar-sign", Desc = "Sell fruits automatically"})
    Tabs.VisualsSection = Window:Section({Title = "Visuals", Opened = false})
    Tabs.VisualsTab = Tabs.VisualsSection:Tab({Title = "ESP Visuals", Icon = "eye", Desc = "Enable ESP"})
    Tabs.SprinklersSection = Window:Section({Title = "Sprinklers", Opened = false})
    Tabs.DeleteTab = Tabs.SprinklersSection:Tab({Title = "Delete", Icon = "trash", Desc = "Delete sprinklers"})
    Tabs.MiscSection = Window:Section({Title = "Miscellaneous", Opened = true})
    Tabs.MiscTab = Tabs.MiscSection:Tab({Title = "Misc Options", Icon = "settings", Desc = "Additional features"})

    local petDropdown
    local petNames = {"[Click Refresh]"}
    petDropdown = Tabs.PetsTab:Dropdown({
        Title = "Select Pets",
        Values = petNames,
        Value = {},
        Multi = true,
        AllowNone = true,
        Callback = function(selectedOptions)
            settings.selectedPets = {}
            selectedOptions = type(selectedOptions) == "table" and selectedOptions or {selectedOptions}
            for petId, petName in pairs(petData) do
                for _, selectedName in ipairs(selectedOptions) do
                    if petName == selectedName then table.insert(settings.selectedPets, petId) end
                end
            end
            if settings.autoMiddleActive and #settings.selectedPets == 0 then
                functions.stopCoroutine("AutoMiddle", coroutines)
                settings.autoMiddleActive = false
            end
            functions.saveSettings(settings)
        end
    })

    Tabs.PetsTab:Button({
        Title = "Refresh Pets",
        Icon = "refresh-cw",
        Callback = function()
            petData = functions.getPetNames(services)
            petNames = {}
            for _, name in pairs(petData) do
                if name and name ~= "" then table.insert(petNames, name) end
            end
            if petDropdown then pcall(function() petDropdown:Destroy() end) end
            petNames = #petNames > 0 and petNames or {"[No Pets Found]"}
            petDropdown = Tabs.PetsTab:Dropdown({
                Title = "Select Pets",
                Values = petNames,
                Value = #petNames > 0 and {petNames[1]} or {},
                Multi = true,
                AllowNone = true,
                Callback = function(selectedOptions)
                    settings.selectedPets = {}
                    selectedOptions = type(selectedOptions) == "table" and selectedOptions or {selectedOptions}
                    for petId, petName in pairs(petData) do
                        for _, selectedName in ipairs(selectedOptions) do
                            if petName == selectedName then table.insert(settings.selectedPets, petId) end
                        end
                    end
                    if settings.autoMiddleActive and #settings.selectedPets == 0 then
                        functions.stopCoroutine("AutoMiddle", coroutines)
                        settings.autoMiddleActive = false
                    end
                    functions.saveSettings(settings)
                end
            })
            settings.selectedPets = {}
            if #petNames > 0 then
                for petId, petName in pairs(petData) do
                    if petName == petNames[1] then table.insert(settings.selectedPets, petId) end
                end
            end
            functions.saveSettings(settings)
        end
    })

    Tabs.PetsTab:Toggle({
        Title = "Auto Middle",
        Icon = "toggle-right",
        Value = settings.autoMiddleActive,
        Type = "Checkbox",
        Callback = function(value)
            settings.autoMiddleActive = value
            if settings.autoMiddleActive and #settings.selectedPets > 0 then
                functions.startCoroutine("AutoMiddle", function()
                    while coroutines.AutoMiddle and coroutines.AutoMiddle.running and #settings.selectedPets > 0 do
                        for _, petId in ipairs(settings.selectedPets) do
                            pcall(function() services.ActivePetService:FireServer("SetPetState", petId, "Idle") end)
                        end
                        wait(0.2)
                    end
                    settings.autoMiddleActive = false
                end, coroutines)
            else
                functions.stopCoroutine("AutoMiddle", coroutines)
                settings.autoMiddleActive = false
            end
            functions.saveSettings(settings)
        end
    })

    local eggDropdown = Tabs.EggsTab:Dropdown({
        Title = "Select Eggs",
        Values = {"All", unpack(tables.eggs)},
        Value = settings.selectedEggs,
        Multi = true,
        AllowNone = true,
        Callback = function(selectedOptions)
            settings.selectedEggs = table.find(selectedOptions, "All") and tables.eggs or {}
            selectedOptions = type(selectedOptions) == "table" and selectedOptions or {selectedOptions}
            for _, egg in ipairs(selectedOptions) do
                if table.find(tables.eggs, egg) then table.insert(settings.selectedEggs, egg) end
            end
            if settings.autoHatchEggsActive and #settings.selectedEggs == 0 then
                functions.stopCoroutine("AutoHatchEggs", coroutines)
                settings.autoHatchEggsActive = false
            end
            if settings.autoPlantEggsActive and #settings.selectedEggs == 0 then
                functions.stopCoroutine("AutoPlantEggs", coroutines)
                settings.autoPlantEggsActive = false
            end
            functions.saveSettings(settings)
        end
    })

    Tabs.EggsTab:Dropdown({
        Title = "Egg Action",
        Values = {"Hatch", "Plant"},
        Value = settings.selectedEggAction,
        Callback = function(value)
            settings.selectedEggAction = value
            if settings.autoHatchEggsActive and settings.selectedEggAction == "Plant" then
                functions.stopCoroutine("AutoHatchEggs", coroutines)
                settings.autoHatchEggsActive = false
            elseif settings.autoPlantEggsActive and settings.selectedEggAction == "Hatch" then
                functions.stopCoroutine("AutoPlantEggs", coroutines)
                settings.autoPlantEggsActive = false
            end
            functions.saveSettings(settings)
        end
    })

    Tabs.EggsTab:Slider({
        Title = "Hatch Delay (ms)",
        Value = {
            Min = 100,
            Max = 2000,
            Default = settings.EggHatchDelay * 1000,
        },
        Callback = function(value)
            settings.EggHatchDelay = value / 1000
            functions.saveSettings(settings)
        end
    })

    Tabs.EggsTab:Slider({
        Title = "Plant Egg Delay (ms)",
        Value = {
            Min = 100,
            Max = 2000,
            Default = settings.EggPlantDelay * 1000,
        },
        Callback = function(value)
            settings.EggPlantDelay = value / 1000
            functions.saveSettings(settings)
        end
    })

    Tabs.EggsTab:Toggle({
        Title = "Auto Hatch Eggs",
        Icon = "egg",
        Value = settings.autoHatchEggsActive,
        Type = "Checkbox",
        Callback = function(value)
            settings.autoHatchEggsActive = value
            if settings.autoHatchEggsActive and #settings.selectedEggs > 0 and settings.selectedEggAction == "Hatch" then
                functions.startCoroutine("AutoHatchEggs", function()
                    local character = services.LocalPlayer.Character
                    if not character or not character:FindFirstChild("HumanoidRootPart") then
                        settings.autoHatchEggsActive = false
                        return
                    end
                    local humanoidRootPart = character.HumanoidRootPart
                    local playerFarm = functions.findPlayerFarm(services)
                    if not playerFarm then
                        settings.autoHatchEggsActive = false
                        return
                    end
                    local objectsPhysical = playerFarm:FindFirstChild("Important") and playerFarm.Important:FindFirstChild("Objects_Physical")
                    if not objectsPhysical then
                        settings.autoHatchEggsActive = false
                        return
                    end
                    while coroutines.AutoHatchEggs and coroutines.AutoHatchEggs.running and #settings.selectedEggs > 0 do
                        local eggList = {}
                        for _, petEgg in ipairs(objectsPhysical:GetChildren()) do
                            if petEgg.Name == "PetEgg" and petEgg:IsA("Model") then
                                for _, egg in ipairs(petEgg:GetChildren()) do
                                    if egg:IsA("Model") and table.find(settings.selectedEggs, egg.Name) then
                                        table.insert(eggList, egg)
                                    end
                                end
                            end
                        end
                        if #eggList == 0 then
                            settings.autoHatchEggsActive = false
                            return
                        end
                        for _, egg in ipairs(eggList) do
                            local hitBox = egg:FindFirstChild("HitBox") or egg:FindFirstChildWhichIsA("BasePart")
                            local proximityPrompt = egg:FindFirstChild("ProximityPrompt", true)
                            if not hitBox or not proximityPrompt then continue end
                            local eggHeight = hitBox.Size.Y
                            humanoidRootPart.CFrame = hitBox.CFrame + Vector3.new(0, eggHeight + 3, 0)
                            wait(0.5)
                            pcall(function() fireproximityprompt(proximityPrompt) end)
                            wait(settings.EggHatchDelay)
                        end
                        wait(1)
                    end
                    settings.autoHatchEggsActive = false
                end, coroutines)
            else
                functions.stopCoroutine("AutoHatchEggs", coroutines)
                settings.autoHatchEggsActive = false
            end
            functions.saveSettings(settings)
        end
    })

    Tabs.EggsTab:Toggle({
        Title = "Auto Plant Eggs",
        Icon = "sprout",
        Value = settings.autoPlantEggsActive,
        Type = "Checkbox",
        Callback = function(value)
            settings.autoPlantEggsActive = value
            if settings.autoPlantEggsActive and #settings.selectedEggs > 0 and settings.selectedEggAction == "Plant" then
                functions.startCoroutine("AutoPlantEggs", function()
                    local character = services.LocalPlayer.Character
                    if not character or not character:FindFirstChild("Humanoid") then
                        settings.autoPlantEggsActive = false
                        return
                    end
                    local playerFarm = functions.findPlayerFarm(services)
                    if not playerFarm then
                        settings.autoPlantEggsActive = false
                        return
                    end
                    local plantLocationsFolder = playerFarm:FindFirstChild("Important") and playerFarm.Important:FindFirstChild("Plant_Locations")
                    if not plantLocationsFolder then
                        settings.autoPlantEggsActive = false
                        return
                    end
                    local placedEggs = {}
                    while coroutines.AutoPlantEggs and coroutines.AutoPlantEggs.running and #settings.selectedEggs > 0 do
                        local locations = {}
                        local basePlate = plantLocationsFolder:GetChildren()[2]
                        if basePlate then
                            if basePlate:IsA("BasePart") then
                                table.insert(locations, basePlate.Position)
                            else
                                for _, part in ipairs(basePlate:GetDescendants()) do
                                    if part:IsA("BasePart") then
                                        table.insert(locations, part.Position)
                                    end
                                end
                            end
                        else
                            settings.autoPlantEggsActive = false
                            return
                        end
                        if #locations == 0 then wait(1) continue end
                        local availableLocations = {}
                        for _, position in ipairs(locations) do
                            local isValid = true
                            for _, eggPos in ipairs(placedEggs) do
                                if (position - eggPos).Magnitude < 5 then
                                    isValid = false
                                    break
                                end
                            end
                            if isValid then table.insert(availableLocations, position) end
                        end
                        if #availableLocations == 0 then wait(1) continue end
                        for _, egg in ipairs(settings.selectedEggs) do
                            local eggTool = nil
                            for _, item in ipairs(services.LocalPlayer.Backpack:GetChildren()) do
                                if item:IsA("Tool") and string.find(item.Name, egg, 1, true) then
                                    eggTool = item
                                    break
                                end
                            end
                            if not eggTool then continue end
                            character.Humanoid:EquipTool(eggTool)
                            local randomIndex = math.random(1, #availableLocations)
                            local position = availableLocations[randomIndex]
                            local success = pcall(function()
                                services.ReplicatedStorage.GameEvents.PetEggService:FireServer("CreateEgg", position)
                            end)
                            if success then table.insert(placedEggs, position) end
                            wait(settings.EggPlantDelay)
                        end
                        wait(1)
                    end
                    settings.autoPlantEggsActive = false
                end, coroutines)
            else
                functions.stopCoroutine("AutoPlantEggs", coroutines)
                settings.autoPlantEggsActive = false
            end
            functions.saveSettings(settings)
        end
    })

    local eggDropdownPurchases = Tabs.PurchasesTab:Dropdown({
        Title = "Select Eggs to Buy",
        Values = {"All", unpack(tables.eggs)},
        Value = settings.selectedEggs,
        Multi = true,
        AllowNone = true,
        Callback = function(selectedOptions)
            settings.selectedEggs = table.find(selectedOptions, "All") and tables.eggs or {}
            selectedOptions = type(selectedOptions) == "table" and selectedOptions or {selectedOptions}
            for _, egg in ipairs(selectedOptions) do
                if table.find(tables.eggs, egg) then table.insert(settings.selectedEggs, egg) end
            end
            if settings.autoBuyEggsActive and #settings.selectedEggs == 0 then
                functions.stopCoroutine("AutoBuyEggs", coroutines)
                settings.autoBuyEggsActive = false
            end
            functions.saveSettings(settings)
        end
    })

    local seedDropdown = Tabs.PurchasesTab:Dropdown({
        Title = "Select Seeds",
        Values = {"All", unpack(tables.seedShopSeeds)},
        Value = settings.selectedSeeds,
        Multi = true,
        AllowNone = true,
        Callback = function(selectedOptions)
            settings.selectedSeeds = table.find(selectedOptions, "All") and tables.seedShopSeeds or {}
            selectedOptions = type(selectedOptions) == "table" and selectedOptions or {selectedOptions}
            for _, seed in ipairs(selectedOptions) do
                if table.find(tables.seedShopSeeds, seed) then table.insert(settings.selectedSeeds, seed) end
            end
            functions.saveSettings(settings)
        end
    })

    local gearDropdown = Tabs.PurchasesTab:Dropdown({
        Title = "Select Gear",
        Values = {"All", unpack(tables.gears)},
        Value = settings.selectedGears,
        Multi = true,
        AllowNone = true,
        Callback = function(selectedOptions)
            settings.selectedGears = table.find(selectedOptions, "All") and tables.gears or {}
            selectedOptions = type(selectedOptions) == "table" and selectedOptions or {selectedOptions}
            for _, gear in ipairs(selectedOptions) do
                if table.find(tables.gears, gear) then table.insert(settings.selectedGears, gear) end
            end
            functions.saveSettings(settings)
        end
    })

    Tabs.PurchasesTab:Toggle({
        Title = "Auto Buy Eggs",
        Icon = "repeat",
        Value = settings.autoBuyEggsActive,
        Type = "Checkbox",
        Callback = function(value)
            settings.autoBuyEggsActive = value
            if settings.autoBuyEggsActive and #settings.selectedEggs > 0 then
                functions.startCoroutine("AutoBuyEggs", function()
                    while coroutines.AutoBuyEggs and coroutines.AutoBuyEggs.running do
                        for _, egg in ipairs(settings.selectedEggs) do
                            pcall(function() services.BuyPetEgg:FireServer(egg) end)
                            wait(0.2)
                        end
                        wait(1)
                    end
                    settings.autoBuyEggsActive = false
                end, coroutines)
            else
                functions.stopCoroutine("AutoBuyEggs", coroutines)
                settings.autoBuyEggsActive = false
            end
            functions.saveSettings(settings)
        end
    })

    Tabs.PurchasesTab:Toggle({
        Title = "Auto Buy Seeds",
        Icon = "repeat",
        Value = settings.autoBuySeedsActive,
        Type = "Checkbox",
        Callback = function(value)
            settings.autoBuySeedsActive = value
            if settings.autoBuySeedsActive and #settings.selectedSeeds > 0 then
                functions.startCoroutine("AutoBuySeeds", function()
                    while coroutines.AutoBuySeeds and coroutines.AutoBuySeeds.running do
                        for _, seed in ipairs(settings.selectedSeeds) do
                            pcall(function() services.BuySeedStock:FireServer(seed) end)
                            wait(0.2)
                        end
                        wait(1)
                    end
                    settings.autoBuySeedsActive = false
                end, coroutines)
            else
                functions.stopCoroutine("AutoBuySeeds", coroutines)
                settings.autoBuySeedsActive = false
            end
            functions.saveSettings(settings)
        end
    })

    Tabs.PurchasesTab:Toggle({
        Title = "Auto Buy Gear",
        Icon = "repeat",
        Value = settings.autoBuyGearActive,
        Type = "Checkbox",
        Callback = function(value)
            settings.autoBuyGearActive = value
            if settings.autoBuyGearActive and #settings.selectedGears > 0 then
                functions.startCoroutine("AutoBuyGear", function()
                    while coroutines.AutoBuyGear and coroutines.AutoBuyGear.running do
                        for _, gear in ipairs(settings.selectedGears) do
                            pcall(function() services.BuyGearStock:FireServer(gear) end)
                            wait(0.2)
                        end
                        wait(1)
                    end
                    settings.autoBuyGearActive = false
                end, coroutines)
            else
                functions.stopCoroutine("AutoBuyGear", coroutines)
                settings.autoBuyGearActive = false
            end
            functions.saveSettings(settings)
        end
    })

    local seedInventoryDropdown
    local function updateSeedInventoryDropdown()
        local seedInventory = functions.getSeedInventory(services, tables)
        if seedInventoryDropdown then pcall(function() seedInventoryDropdown:Destroy() end) end
        seedInventoryDropdown = Tabs.FarmingTab:Dropdown({
            Title = "Select Seed to Plant",
            Values = #seedInventory > 0 and seedInventory or {"[No Seeds Found]"},
            Value = settings.selectedSeed,
            Callback = function(value)
                settings.selectedSeed = value
                if settings.autoPlantActive and not functions.equipSeed(settings.selectedSeed, services) then
                    functions.stopCoroutine("AutoPlant", coroutines)
                    settings.autoPlantActive = false
                end
                functions.saveSettings(settings)
            end
        })
    end

    Tabs.FarmingTab:Dropdown({
        Title = "Planting Location",
        Values = {"Current Location", "Saved Location"},
        Value = settings.plantingMode,
        Callback = function(value)
            settings.plantingMode = value
            if settings.autoPlantActive and settings.plantingMode == "Saved Location" and not settings.savedPlantingLocation then
                functions.stopCoroutine("AutoPlant", coroutines)
                settings.autoPlantActive = false
            end
            if settings.autoPlantEggsActive and settings.plantingMode == "Saved Location" and not settings.savedPlantingLocation then
                functions.stopCoroutine("AutoPlantEggs", coroutines)
                settings.autoPlantEggsActive = false
            end
            functions.saveSettings(settings)
        end
    })

    Tabs.FarmingTab:Button({
        Title = "Save Current Location",
        Icon = "map-pin",
        Callback = function()
            local character = services.LocalPlayer.Character
            if character and character:FindFirstChild("HumanoidRootPart") then
                settings.savedPlantingLocation = character.HumanoidRootPart.Position
                functions.saveSettings(settings)
            end
        end
    })

    Tabs.FarmingTab:Button({
        Title = "Refresh Seed Inventory",
        Icon = "refresh-cw",
        Callback = function()
            updateSeedInventoryDropdown()
        end
    })

    Tabs.FarmingTab:Slider({
        Title = "Plant Delay (ms)",
        Value = {
            Min = 1,
            Max = 1000,
            Default = settings.PlantDelay * 1000,
        },
        Callback = function(value)
            settings.PlantDelay = value / 1000
            functions.saveSettings(settings)
        end
    })

    Tabs.FarmingTab:Toggle({
        Title = "Auto Plant",
        Icon = "sprout",
        Value = settings.autoPlantActive,
        Type = "Checkbox",
        Callback = function(value)
            settings.autoPlantActive = value
            if settings.autoPlantActive then
                if not functions.equipSeed(settings.selectedSeed, services) then
                    settings.autoPlantActive = false
                    functions.saveSettings(settings)
                    return
                end
                if settings.plantingMode == "Saved Location" and not settings.savedPlantingLocation then
                    settings.autoPlantActive = false
                    functions.saveSettings(settings)
                    return
                end
                functions.startCoroutine("AutoPlant", function()
                    while coroutines.AutoPlant and coroutines.AutoPlant.running do
                        local position = functions.getPlantingPosition(services, settings)
                        if position then
                            pcall(function() services.Plant_RE:FireServer(position, settings.selectedSeed) end)
                        end
                        wait(settings.PlantDelay)
                    end
                    settings.autoPlantActive = false
                end, coroutines)
            else
                functions.stopCoroutine("AutoPlant", coroutines)
                settings.autoPlantActive = false
            end
            functions.saveSettings(settings)
        end
    })

    local fruitDropdown = Tabs.HarvestingTab:Dropdown({
        Title = "Select Fruits",
        Values = {"All", unpack(tables.allFruits)},
        Value = settings.TargetFruits,
        Multi = true,
        AllowNone = true,
        Callback = function(selectedOptions)
            settings.TargetFruits = table.find(selectedOptions, "All") and {} or {}
            selectedOptions = type(selectedOptions) == "table" and selectedOptions or {selectedOptions}
            for _, fruit in ipairs(selectedOptions) do
                if table.find(tables.allFruits, fruit) then table.insert(settings.TargetFruits, fruit) end
            end
            functions.saveSettings(settings)
        end
    })

    local mutationDropdown = Tabs.HarvestingTab:Dropdown({
        Title = "Select Mutations",
        Values = {"All", unpack(mutationNames)},
        Value = settings.TargetMutations,
        Multi = true,
        AllowNone = true,
        Callback = function(selectedOptions)
            settings.TargetMutations = table.find(selectedOptions, "All") and {} or {}
            selectedOptions = type(selectedOptions) == "table" and selectedOptions or {selectedOptions}
            for _, mutation in ipairs(selectedOptions) do
                if table.find(mutationNames, mutation) then table.insert(settings.TargetMutations, mutation) end
            end
            functions.saveSettings(settings)
        end
    })

    Tabs.HarvestingTab:Slider({
        Title = "Min Weight (kg)",
        Value = {
            Min = 0,
            Max = 1000,
            Default = settings.MinimumWeight,
        },
        Callback = function(value)
            settings.MinimumWeight = value
            functions.saveSettings(settings)
        end
    })

    Tabs.HarvestingTab:Slider({
        Title = "Harvest Delay (ms)",
        Value = {
            Min = 10,
            Max = 1000,
            Default = settings.HarvestDelay * 1000,
        },
        Callback = function(value)
            settings.HarvestDelay = value / 1000
            functions.saveSettings(settings)
        end
    })

    Tabs.HarvestingTab:Toggle({
        Title = "Auto Harvest",
        Icon = "apple",
        Value = settings.autoHarvestActive,
        Type = "Checkbox",
        Callback = function(value)
            settings.autoHarvestActive = value
            if settings.autoHarvestActive then
                functions.startCoroutine("AutoHarvest", function()
                    while coroutines.AutoHarvest and coroutines.AutoHarvest.running do
                        for _, Plant in ipairs(functions.GetHarvestablePlants(services, tables, settings)) do
                            functions.HarvestPlant(Plant)
                        end
                        wait(settings.HarvestDelay)
                    end
                    settings.autoHarvestActive = false
                end, coroutines)
            else
                functions.stopCoroutine("AutoHarvest", coroutines)
                settings.autoHarvestActive = false
            end
            functions.saveSettings(settings)
        end
    })

    Tabs.SellingTab:Slider({
        Title = "Sell Delay (min)",
        Value = {
            Min = 1,
            Max = 60,
            Default = settings.SellDelay,
        },
        Callback = function(value)
            settings.SellDelay = value
            functions.saveSettings(settings)
        end
    })

    Tabs.SellingTab:Toggle({
        Title = "Auto Sell Fruits",
        Icon = "dollar-sign",
        Value = settings.autoSellActive,
        Type = "Checkbox",
        Callback = function(value)
            settings.autoSellActive = value
            if settings.autoSellActive then
                functions.startCoroutine("AutoSell", function()
                    while coroutines.AutoSell and coroutines.AutoSell.running do
                        local originalPosition = functions.teleportToSellCoordinates(services, tables)
                        pcall(function() services.Sell_Inventory:FireServer() end)
                        if originalPosition and services.LocalPlayer.Character and services.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                            services.LocalPlayer.Character.HumanoidRootPart.CFrame = originalPosition
                        end
                        wait(settings.SellDelay * 60)
                    end
                    settings.autoSellActive = false
                end, coroutines)
            else
                functions.stopCoroutine("AutoSell", coroutines)
                settings.autoSellActive = false
            end
            functions.saveSettings(settings)
        end
    })

    local sprinklerDropdown = Tabs.DeleteTab:Dropdown({
        Title = "Select Sprinklers",
        Values = {"All", unpack(tables.sprinklerTypes)},
        Value = settings.selectedSprinklers,
        Multi = true,
        AllowNone = true,
        Callback = function(selectedOptions)
            settings.selectedSprinklers = table.find(selectedOptions, "All") and tables.sprinklerTypes or {}
            selectedOptions = type(selectedOptions) == "table" and selectedOptions or {selectedOptions}
            for _, sprinkler in ipairs(selectedOptions) do
                if table.find(tables.sprinklerTypes, sprinkler) then
                    functions.CoreFunctions.addSprinklerToSelection(sprinkler)
                end
            end
            local newSelectedSprinklers = {}
            for _, sprinkler in ipairs(settings.selectedSprinklers) do
                if table.find(selectedOptions, sprinkler) or table.find(selectedOptions, "All") then
                    table.insert(newSelectedSprinklers, sprinkler)
                end
            end
            functions.CoreFunctions.setSelectedSprinklers(newSelectedSprinklers)
            if settings.autoDeleteSprinklersActive and #settings.selectedSprinklers == 0 then
                functions.stopCoroutine("AutoDeleteSprinklers", coroutines)
                settings.autoDeleteSprinklersActive = false
            end
            functions.saveSettings(settings)
        end
    })

    Tabs.DeleteTab:Toggle({
        Title = "Auto Delete Sprinklers",
        Icon = "trash",
        Value = settings.autoDeleteSprinklersActive,
        Type = "Checkbox",
        Callback = function(value)
            settings.autoDeleteSprinklersActive = value
            if settings.autoDeleteSprinklersActive and #settings.selectedSprinklers > 0 then
                functions.startCoroutine("AutoDeleteSprinklers", function()
                    while coroutines.AutoDeleteSprinklers and coroutines.AutoDeleteSprinklers.running do
                        functions.CoreFunctions.deleteSprinklers(settings.selectedSprinklers, services)
                        wait(2)
                    end
                    settings.autoDeleteSprinklersActive = false
                end, coroutines)
            else
                functions.stopCoroutine("AutoDeleteSprinklers", coroutines)
                settings.autoDeleteSprinklersActive = false
            end
            functions.saveSettings(settings)
        end
    })

    Tabs.VisualsTab:Toggle({
        Title = "Fruit ESP",
        Icon = "eye",
        Value = settings.fruitESPActive,
        Type = "Checkbox",
        Callback = function(value)
            settings.fruitESPActive = value
            functions.processPlants(services, tables, settings)
            functions.saveSettings(settings)
        end
    })

    Tabs.VisualsTab:Toggle({
        Title = "Pet Cooldown ESP",
        Icon = "eye",
        Value = settings.petCooldownESPActive,
        Type = "Checkbox",
        Callback = function(value)
            settings.petCooldownESPActive = value
            if settings.petCooldownESPActive then
                functions.updatePetCooldowns(services, settings, petData, petModelCache)
                local lastUpdate = 0
                local connection
                connection = services.RunService.Heartbeat:Connect(function()
                    local currentTime = tick()
                    if currentTime - lastUpdate >= 3 then
                        functions.updatePetCooldowns(services, settings, petData, petModelCache)
                        lastUpdate = currentTime
                    end
                end)
                local scrollingFrame = services.LocalPlayer.PlayerGui:WaitForChild("ActivePetUI"):WaitForChild("Frame"):WaitForChild("Main"):WaitForChild("ScrollingFrame")
                local childAddedConnection = scrollingFrame.ChildAdded:Connect(function()
                    functions.updatePetCooldowns(services, settings, petData, petModelCache)
                end)
                local childRemovedConnection = scrollingFrame.ChildRemoved:Connect(function()
                    functions.updatePetCooldowns(services, settings, petData, petModelCache)
                end)
                game:BindToClose(function()
                    connection:Disconnect()
                    childAddedConnection:Disconnect()
                    childRemovedConnection:Disconnect()
                end)
            else
                functions.updatePetCooldowns(services, settings, petData, petModelCache)
            end
            functions.saveSettings(settings)
        end
    })

    Tabs.MiscTab:Toggle({
        Title = "Anti-Idle",
        Icon = "clock",
        Value = settings.antiIdleActive,
        Type = "Checkbox",
        Callback = function(value)
            settings.antiIdleActive = value
            if settings.antiIdleActive then
                functions.startCoroutine("AntiIdle", function() functions.antiAFK(services, coroutines) end, coroutines)
            else
                functions.stopCoroutine("AntiIdle", coroutines)
            end
            functions.saveSettings(settings)
        end
    })

    local function updateESP()
        while true do
            if settings.fruitESPActive then pcall(function() functions.processPlants(services, tables, settings) end) end
            if settings.petCooldownESPActive then pcall(function() functions.updatePetCooldowns(services, settings, petData, petModelCache) end) end
            wait(3) -- Increased interval for lower resource usage
        end
    end

    local function updateSeedInventoryPeriodically()
        while true do
            if settings.autoPlantActive then pcall(updateSeedInventoryDropdown) end
            wait(15) -- Increased interval
        end
    end

    spawn(updateESP)
    spawn(updateSeedInventoryPeriodically)
    updateSeedInventoryDropdown()

    game:BindToClose(function()
        functions.saveSettings(settings)
    end)
end

return createUI
